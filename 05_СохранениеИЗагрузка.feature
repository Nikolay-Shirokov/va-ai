# encoding: utf-8
# language: ru

@UI @FileOperations
Функционал: 05 - Сохранение и загрузка соответствия ролей

  Как пользователь
  Я хочу сохранять и загружать настройки анализа
  Чтобы повторно использовать их в будущем

Контекст:
  Дано Я запускаю сценарий открытия TestClient или подключаю уже существующий
  И Я закрыл все окна клиентского приложения
  И В панели функций я выбираю "Анализ полномочий ролей"
  Тогда открылось окно "Анализ полномочий ролей"

Сценарий: TS-08 - Сохранение соответствия в JSON
  Дано из выпадающего списка "Роль источник" я выбираю по строке "РольCRM"
  И в таблице "РолиПриемники" я перехожу к строке:
    | Роль |
    | Основная_Менеджер |
  И в таблице "РолиПриемники" я устанавливаю флаг "Отметка"
  И в таблице "РолиПриемники" я перехожу к строке:
    | Роль |
    | Основная_Админ |
  И в таблице "РолиПриемники" я устанавливаю флаг "Отметка"

  Когда я нажимаю на кнопку "Дополнительно"
  И я выбираю пункт меню "Сохранить соответствие"
  И я выбираю файл "test_mapping.json"
  Тогда в логе сообщений TestClient есть строка "Соответствие ролей сохранено в файл"
  # Проверяем содержимое файла
  И файл "test_mapping.json" содержит строки:
    | *"source_role": "РольCRM"* |
    | *"target_roles":* |
    | *"Основная_Менеджер"* |
    | *"Основная_Админ"* |

Сценарий: TS-09 - Загрузка соответствия из JSON
  # Предварительно создаем файл с настройками
  И я создаю файл "test_mapping_for_load.json"
      | {
      |   "mappings": [
      |     {
      |       "source_role": "РольWMS",
      |       "target_roles": ["Основная_Склад"]
      |     }
      |   ]
      | }
  Когда я нажимаю на кнопку "Дополнительно"
  И я выбираю пункт меню "Загрузить соответствие"
  И я выбираю файл "test_mapping_for_load.json"
  Тогда в логе сообщений TestClient есть строка "Соответствие ролей загружено из файла"

  # Проверяем, что форма заполнилась данными из файла
  И элемент формы с именем "Роль источник" стал равен "РольWMS"
  И в таблице "РолиПриемники" я перехожу к строке:
      | Роль |
      | Основная_Склад |
  И в таблице "РолиПриемники" флаг "Отметка" равен "Истина"

Сценарий: TS-10 - Загрузка некорректного JSON файла
  # Предварительно создаем некорректный файл
  И я создаю файл "broken.json"
      | {bad json}
  Когда я нажимаю на кнопку "Дополнительно"
  И я выбираю пункт меню "Загрузить соответствие"
  И я выбираю файл "broken.json"
  Тогда появилось предупреждение, содержащее текст "Ошибка чтения файла соответствия"