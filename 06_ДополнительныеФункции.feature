# encoding: utf-8
# language: ru

@UI @AdditionalFunctions
Функционал: 06 - Дополнительные функции обработки

  Как пользователь
  Я хочу иметь возможность выгружать отчет и управлять отметками
  Чтобы эффективно работать с результатами анализа

Контекст:
  Дано Я запускаю сценарий открытия TestClient или подключаю уже существующий
  И Я закрыл все окна клиентского приложения
  И В панели функций я выбираю "Анализ полномочий ролей"
  Тогда открылось окно "Анализ полномочий ролей"

Сценарий: TS-11 - Выгрузка отчета в текстовый файл
  # Готовим данные для анализа
  Дано из выпадающего списка "Роль источник" я выбираю по строке "РольИсточник_ПолныеПрава"
  И в таблице "РолиПриемники" я перехожу к строке
  | 'Роль' |
  | 'РольПриемник_Чтение' |
  И в таблице "РолиПриемники" я устанавливаю флаг "Отметка"
  Когда я нажимаю на кнопку "Анализировать"
  Тогда открылось окно "Результат анализа полномочий"

  # Выгружаем отчет
  Когда я нажимаю на кнопку "Дополнительно"
  И я выбираю пункт меню "Выгрузить отчет"
  И я выбираю файл "report.txt"
  Тогда в логе сообщений TestClient есть строка "Отчет сохранен в файл"
  # Проверяем, что файл создан и не пуст
  И Файл "report.txt" существует
  И файл "report.txt" содержит строки:
    | *Анализ полномочий для роли: РольИсточник_ПолныеПрава* |
    | *РольПриемник_Чтение* |
    | *Справочник.Номенклатура* |

Сценарий: TS-12 - Очистка отметок
  Дано в таблице "РолиПриемники" я перехожу к строке
  | 'Роль' |
  | 'РольТест1' |
  И в таблице "РолиПриемники" я устанавливаю флаг "Отметка"
  И в таблице "РолиПриемники" я перехожу к строке
  | 'Роль' |
  | 'РольCRM' |
  И в таблице "РолиПриемники" я устанавливаю флаг "Отметка"
  И в таблице "РолиПриемники" я перехожу к строке
  | 'Роль' |
  | 'РольWMS' |
  И в таблице "РолиПриемники" я устанавливаю флаг "Отметка"

  Когда я нажимаю на кнопку "Дополнительно"
  И в открывшемся меню я выбираю "Очистить отметки"

  # Проверяем, что все отметки сняты
  Тогда в таблице "РолиПриемники" флаг "Отметка" равен "Ложь"
  И в таблице "РолиПриемники" я перехожу к строке номер "2"
  И в таблице "РолиПриемники" флаг "Отметка" равен "Ложь"
  И в таблице "РолиПриемники" я перехожу к строке номер "3"
  И в таблице "РолиПриемники" флаг "Отметка" равен "Ложь"