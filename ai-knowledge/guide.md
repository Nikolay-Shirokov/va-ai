# Руководство для AI-ассистента: Генерация сценариев Vanessa Automation

## 1. Основная информация

**Vanessa Automation** - это фреймворк для BDD-тестирования 1С:Предприятие. Сценарии пишутся на языке **Turbo Gherkin** (расширенная версия Gherkin).

### Ключевые понятия:
- **Feature** (Функционал) - файл с описанием функциональности
- **Scenario** (Сценарий) - конкретный тест-кейс
- **Step** (Шаг) - атомарное действие или проверка
- **Context** (Контекст) - предусловия, выполняемые перед каждым сценарием

## 2. Структура Feature-файла

```gherkin
# encoding: utf-8
# language: ru

@ТегФичи
Функционал: Название функционала
    Как <роль>
    Я хочу <действие>
    Чтобы <результат>

Контекст:
    Дано <предусловие 1>
    И <предусловие 2>

@ТегСценария
Сценарий: Название сценария
    Дано <начальное условие>
    Когда <действие>
    И <дополнительное действие>
    Тогда <проверка результата>
    И <дополнительная проверка>
```

## 3. Ключевые слова (Keywords)

| Русский | Английский | Назначение |
|---------|-----------|------------|
| Дано | Given | Предусловия, подготовка |
| Когда | When | Действия |
| Тогда | Then | Проверки, ожидаемый результат |
| И | And | Продолжение предыдущего типа |
| Также | Also | Продолжение предыдущего типа |
| Затем | Then | Проверки, ожидаемый результат |
| Но | But | Отрицательная проверка |

## 4. Система тегов

Теги используются для фильтрации и управления выполнением сценариев:

- `@Draft@` - черновик, не готов к выполнению
- `@Предварительно` - начальные заметки
- `@IgnoreOnCIMainBuild` - игнорировать при CI/CD
- `@Smoke` - дымовые тесты
- `@Critical` - критичные тесты
- Пользовательские теги для группировки

## 5. Основные категории шагов (1569 доступных шагов)

### 5.1. UI - Работа с пользовательским интерфейсом (618 шагов)

#### Работа с окнами и формами
```gherkin
И я открываю форму "ИмяФормы"
И я закрываю форму "ИмяФормы"
Тогда открылось окно "ЗаголовокОкна"
И я закрываю все окна клиентского приложения
И я запоминаю заголовок формы в переменную "ИмяПеременной"
```

#### Работа с полями формы
```gherkin
И в поле "ИмяПоля" я ввожу текст "Значение"
И в поле с именем "ИмяПоля" я ввожу текст "Значение"
И я выбираю значение "Значение" из выпадающего списка "ИмяПоля"
И я очищаю поле "ИмяПоля"
Тогда элемент формы с именем "ИмяПоля" стал равен "Значение"
И я проверяю, что поле "ИмяПоля" доступно
И я проверяю, что поле "ИмяПоля" недоступно
И я проверяю, что поле "ИмяПоля" видимо
И я проверяю, что поле "ИмяПоля" скрыто
```

#### Работа с датами
```gherkin
И в поле "ИмяПоля" я ввожу дату "ДД.ММ.ГГГГ"
И в поле "ИмяПоля" я ввожу текущую дату
И в поле "ИмяПоля" я ввожу дату "ТекущаяДата + 5"
И в поле "ИмяПоля" я ввожу дату "ТекущаяДата - 3"
```

#### Работа с таблицами
```gherkin
И в таблице "ИмяТаблицы" я нажимаю на кнопку "Добавить"
И в таблице "ИмяТаблицы" я нажимаю на кнопку "Удалить"
И в таблице "ИмяТаблицы" я перехожу к строке номер "НомерСтроки"
И в таблице "ИмяТаблицы" я выбираю текущую строку
И в таблице "ИмяТаблицы" я активизирую поле "ИмяКолонки"
И в таблице "ИмяТаблицы" в поле "ИмяКолонки" я ввожу текст "Значение"
Тогда таблица "ИмяТаблицы" содержит "КоличествоСтрок" строк
И в таблице "ИмяТаблицы" я устанавливаю флаг в строке номер "НомерСтроки"
И в таблице "ИмяТаблицы" я снимаю флаг в строке номер "НомерСтроки"
```

#### Работа с кнопками и гиперссылками
```gherkin
И я нажимаю на кнопку "ИмяКнопки"
И я нажимаю на кнопку с именем "ИмяКнопки"
И я нажимаю на гиперссылку "ТекстГиперссылки"
И я нажимаю на кнопку командного интерфейса "ИмяКнопки"
```

#### Навигационные ссылки (работа с объектами)
```gherkin
И я открываю навигационную ссылку "e1cib/data/..."
И я запоминаю навигационную ссылку активного объекта в переменную "ИмяПеременной"
И я проверяю, что навигационная ссылка активного объекта равна "$ИмяПеременной$"
```

### 5.2. Переменные (36 шагов)

```gherkin
И я запоминаю значение поля "ИмяПоля" как "ИмяПеременной"
И я запоминаю значение поля с именем "ИмяПоля" как "ИмяПеременной"
И я запоминаю значение выражения "1+1" в переменную "ИмяПеременной"
Тогда значение переменной "ИмяПеременной" равно "Значение"
И я удаляю переменную "ИмяПеременной"
И я вывожу значение переменной "ИмяПеременной" в лог
```

**Использование переменных в шагах:**
```gherkin
И в поле "ИмяПоля" я ввожу текст "$ИмяПеременной$"
```

### 5.3. Работа с файлами (36 шагов)

```gherkin
И я загружаю файл "ИмяФайла" из каталога "ПутьКаталога"
И я выгружаю файл в каталог "ПутьКаталога"
И я проверяю, что файл "ИмяФайла" существует в каталоге "ПутьКаталога"
И я удаляю файл "ИмяФайла" из каталога "ПутьКаталога"
```

### 5.4. Объекты конфигурации (30 шагов)

```gherkin
И я создаю новый объект "ТипОбъекта.ИмяОбъекта"
И я заполняю реквизит "ИмяРеквизита" значением "Значение"
И я провожу документ
И я отменяю проведение документа
И я удаляю объект
И я записываю объект
```

### 5.5. Инициатор данных - Генератор тестовых данных (36 шагов)

```gherkin
И я создаю объекты через инициатор данных
И я генерирую тестовые данные
И я очищаю базу от тестовых данных
```

### 5.6. Проверки и ожидания

```gherkin
Тогда я жду, что в форме будет значение "Значение" в течение "Секунд" секунд
И я жду открытия формы "ИмяФормы" в течение "Секунд" секунд
Тогда появилось предупреждение "ТекстПредупреждения"
Тогда появился вопрос "ТекстВопроса"
И я отвечаю "Да" на вопрос
И я отвечаю "Нет" на вопрос
```

### 5.7. Работа с отчетами

```gherkin
И я формирую отчет "ИмяОтчета"
И вариант отчета "ИмяОтчета" "ИмяВарианта" равен макету "ИмяМакета"
И я сравниваю отчет с эталоном
```

### 5.8. Служебные шаги (453 шагов)

```gherkin
И пауза "Секунд"
И я делаю снимок экрана
И я вывожу в лог "Текст"
И я закрываю TestClient
И я перезапускаю TestClient
```

### 5.9. Allure - отчетность (5 шагов)

```gherkin
И Я устанавливаю название фичи 'Название'
Когда Я устанавливаю название эпика 'Название'
И Я устанавливаю название истории 'Название'
И Я устанавливаю метке 'Метка' значение 'Значение'
И я устанавливаю описание сценария для отчета Allure 'Описание'
```

## 6. Рекомендуемые практики написания сценариев

### 6.1. Разделение тестирования форм и движений документов

**Для тестирования движений (рекомендуемый подход):**
```gherkin
Сценарий: Проверка движений документа "Приобретение товаров"
    # Отменяем проведение всех документов цепочки
    И я отменяю проведение всех документов этого сценария по их навигационным ссылкам (расширение)
    
    # Проводим документы программно
    И я выполняю проведение документа по навигационной ссылке "e1cib/data/Документ.ПриобретениеТоваровУслуг?ref=..." (расширение)
    И я выполняю проведение документа по навигационной ссылке "e1cib/data/Документ.ЗаказКлиента?ref=..." (расширение)
    
    # Проверяем результат через отчет
    И вариант отчета "ОстаткиИДоступностьТоваров" "Остатки и доступность товаров" равен макету "ЭталонноеЗначениеОтчета" (расширение)
    
    # Возвращаем базу в исходное состояние
    И я отменяю проведение всех документов этого сценария по их навигационным ссылкам (расширение)
```

**Для тестирования форм:**
```gherkin
Сценарий: Создание нового документа через форму
    Дано Я открываю навигационную ссылку "e1cib/list/Документ.ЗаказПокупателя"
    Когда В панели разделов я выбираю "Продажи"
    И В командной панели я нажимаю "Заказы покупателей"
    И я нажимаю на кнопку "Создать"
    Тогда открылось окно "Заказ покупателя (создание)"
    И из выпадающего списка "Организация" я выбираю по строке "ООО Рога и копыта"
    И из выпадающего списка "Покупатель" я выбираю по строке "Петров Иван Петрович"
    И в таблице "Товары" я нажимаю на кнопку "Добавить"
    И в таблице "Товары" в поле "Номенклатура" я ввожу текст "Товар 1"
    И в таблице "Товары" я завершаю редактирование строки
    И я нажимаю на кнопку "Провести"
    Тогда элемент формы с именем "Проведен" стал равен "Да"
```

### 6.2. Использование подсценариев для избежания дублирования

Подсценарии позволяют переиспользовать общие последовательности шагов:

```gherkin
# Основной сценарий
Сценарий: Создание заказа покупателя
    И я выполняю подсценарий "ОткрытиеСпискаЗаказов"
    И я выполняю подсценарий "СозданиеНовогоЗаказа"
    И я выполняю подсценарий "ПроверкаПроведенияДокумента"
```

### 6.3. Структура типичного сценария

```gherkin
@Тег
Сценарий: Название сценария
    # 1. Подготовка (Given/Дано)
    Дано <открыть форму/список>
    И <подготовить данные>
    
    # 2. Действие (When/Когда)
    Когда <выполнить основное действие>
    И <выполнить дополнительные действия>
    
    # 3. Проверка (Then/Тогда)
    Тогда <проверить результат>
    И <дополнительные проверки>
    
    # 4. Очистка (опционально)
    И <вернуть систему в исходное состояние>
```

### 6.4. Использование таблиц данных

```gherkin
Сценарий: Заполнение табличной части товарами
    И в таблице "Товары" я нажимаю на кнопку "Заполнить"
    Тогда таблица "Товары" стала равной:
        | Номенклатура | Количество | Цена  |
        | Товар 1     | 10         | 100.00|
        | Товар 2     | 5          | 200.00|
```

## 7. Правила для AI-ассистента

### 7.1. КРИТИЧЕСКИ ВАЖНО

1. **ИСПОЛЬЗОВАТЬ ТОЛЬКО ШАГИ ИЗ БИБЛИОТЕКИ** - не выдумывать новые шаги
2. **СОБЛЮДАТЬ СИНТАКСИС GHERKIN** - правильная последовательность ключевых слов
3. **ИСПОЛЬЗОВАТЬ ПРАВИЛЬНЫЕ КАВЫЧКИ** - только двойные кавычки `""`
4. **ПРОВЕРЯТЬ ИМЕНА ПОЛЕЙ** - использовать либо заголовки, либо имена полей
5. **НЕ СМЕШИВАТЬ ПОДХОДЫ** - тестирование форм отдельно от движений

### 7.2. Алгоритм генерации сценария

1. **Понять задачу**: какая функциональность тестируется?
2. **Определить тип теста**: форма или движения?
3. **Выбрать подходящие шаги** из библиотеки
4. **Структурировать сценарий**: Given → When → Then
5. **Добавить проверки**: минимум одну проверку результата
6. **Проверить синтаксис**: все ли шаги из библиотеки?

### 7.3. Шаблон для ответа AI

При генерации сценария AI должен:

1. **Проанализировать требование**
2. **Создать Feature-файл** с правильной структурой
3. **Объяснить логику** сценария
4. **Указать используемые категории шагов**
5. **Предупредить о зависимостях** (нужны ли подготовленные данные)

### 7.4. Проверочный чеклист перед выдачей сценария

- [ ] Все шаги есть в библиотеке?
- [ ] Правильные ключевые слова (Дано/Когда/Тогда)?
- [ ] Есть минимум одна проверка (Тогда)?
- [ ] Правильная кодировка и язык указаны в заголовке?
- [ ] Логичная последовательность шагов?
- [ ] Переменные используются корректно (`$ИмяПеременной$`)?
- [ ] Есть теги для фильтрации?

## 8. Примеры готовых сценариев

### Пример 1: Тестирование формы

```gherkin
# encoding: utf-8
# language: ru

@ТестированиеФормы
Функционал: Создание справочника "Контрагенты"
    Как пользователь системы
    Я хочу создать нового контрагента
    Чтобы использовать его в документах

Сценарий: Успешное создание контрагента
    Дано Я открываю навигационную ссылку "e1cib/list/Справочник.Контрагенты"
    Когда я нажимаю на кнопку "Создать"
    Тогда открылось окно "Контрагент (создание)"
    И в поле "Наименование" я ввожу текст "ООО Тестовая компания"
    И в поле "ИНН" я ввожу текст "1234567890"
    И я нажимаю на кнопку "Записать и закрыть"
    Тогда элемент формы с именем "Наименование" стал равен "ООО Тестовая компания"
```

### Пример 2: Тестирование движений

```gherkin
# encoding: utf-8
# language: ru

@ТестированиеДвижений
Функционал: Проверка движений документа "Поступление товаров"
    Как разработчик
    Я хочу проверить корректность движений документа
    Чтобы убедиться в правильности учета

Контекст:
    Дано Существует эталонная база с подготовленными документами

Сценарий: Проверка остатков после поступления товаров
    # Приводим базу в исходное состояние
    И я отменяю проведение всех документов этого сценария по их навигационным ссылкам (расширение)
    
    # Проводим документ программно
    И я выполняю проведение документа по навигационной ссылке "e1cib/data/Документ.ПоступлениеТоваров?ref=a9b6cd2e3f4g5h6i7j8k9l0m1n2o3p4q" (расширение)
    
    # Проверяем результат
    И вариант отчета "ОстаткиТоваров" "Остатки на складе" равен макету "ЭталонОстаткиПослеПоступления" (расширение)
    
    # Возвращаем базу в исходное состояние
    И я отменяю проведение всех документов этого сценария по их навигационным ссылкам (расширение)
```

### Пример 3: Использование переменных

```gherkin
# encoding: utf-8
# language: ru

@ИспользованиеПеременных
Функционал: Создание связанных документов
    Как пользователь
    Я хочу создать цепочку документов
    Чтобы проверить их взаимосвязь

Сценарий: Создание заказа и отгрузки
    # Создаем заказ
    Дано я открываю навигационную ссылку "e1cib/list/Документ.ЗаказПокупателя"
    Когда я нажимаю на кнопку "Создать"
    И в поле "Покупатель" я ввожу текст "ООО Покупатель"
    И я нажимаю на кнопку "Записать"
    И я запоминаю навигационную ссылку активного объекта в переменную "СсылкаНаЗаказ"
    И я закрываю текущее окно
    
    # Создаем отгрузку на основании заказа
    И я открываю навигационную ссылку "$СсылкаНаЗаказ$"
    И я нажимаю на кнопку "Создать на основании"
    И я нажимаю на кнопку "Отгрузка товаров"
    Тогда открылось окно "Отгрузка товаров (создание)"
    И я проверяю, что поле "ДокументОснование" стало равно "$СсылкаНаЗаказ$"
```

## 9. Типичные ошибки и как их избежать

### Ошибка 1: Использование несуществующих шагов

❌ **Неправильно:**
```gherkin
И я ввожу в поле "Наименование" значение "Текст"
```

✅ **Правильно:**
```gherkin
И в поле "Наименование" я ввожу текст "Текст"
```

### Ошибка 2: Неправильные кавычки

❌ **Неправильно:**
```gherkin
И в поле 'Наименование' я ввожу текст 'Текст'
```

✅ **Правильно:**
```gherkin
И в поле "Наименование" я ввожу текст "Текст"
```

### Ошибка 3: Отсутствие проверок

❌ **Неправильно:**
```gherkin
Сценарий: Создание документа
    Дано я открыл форму
    Когда я ввел данные
    И я нажал кнопку "Записать"
```

✅ **Правильно:**
```gherkin
Сценарий: Создание документа
    Дано я открыл форму
    Когда я ввел данные
    И я нажал кнопку "Записать"
    Тогда элемент формы с именем "Проведен" стал равен "Да"
```

### Ошибка 4: Смешивание подходов

❌ **Неправильно:**
```gherkin
# Открываем форму И проверяем движения одновременно
Сценарий: Тест
    Дано я открыл форму документа
    Когда я провел документ через форму
    Тогда я проверяю движения программно
```

✅ **Правильно** - разделить на два сценария:
```gherkin
Сценарий: Проведение документа через форму
    Дано я открыл форму документа
    Когда я провел документ через форму
    Тогда элемент формы с именем "Проведен" стал равен "Да"

Сценарий: Проверка движений документа
    И я выполняю проведение документа по навигационной ссылке "..." (расширение)
    Тогда вариант отчета "Отчет" "Вариант" равен макету "Эталон" (расширение)
```

## 10. Расширенные возможности

### 10.1. Работа с буфером обмена (требуется VanessaExt)

```gherkin
И я запоминаю значение поля "ИмяПоля" в буфер обмена
И я вставляю текстовое значение буфера обмена в поле с именем "ДругоеПоле"
И я запоминаю значение буфера обмена в переменную "ИмяПеременной"
```

### 10.2. Работа с вложенными таблицами

```gherkin
И в таблице "ТабличнаяЧасть" я перехожу к строке номер "1"
И в таблице "ТабличнаяЧасть" я разворачиваю строку номер "1"
И в таблице "ВложеннаяТаблица" в поле "Поле" я ввожу текст "Значение"
```

### 10.3. Работа с деревьями

```gherkin
И в дереве "ДеревоЗначений" я разворачиваю строку номер "1"
И в дереве "ДеревоЗначений" я выбираю строку номер "2"
```

## 11. Контрольные вопросы для проверки сценария

Перед запуском сценария убедитесь:

1. ✅ Указана кодировка `# encoding: utf-8`?
2. ✅ Указан язык `# language: ru`?
3. ✅ Есть блок `Функционал:` с описанием?
4. ✅ Все шаги из библиотеки Vanessa Automation?
5. ✅ Используются правильные ключевые слова?
6. ✅ Есть хотя бы одна проверка (Тогда)?
7. ✅ Переменные обрамлены `$...$`?
8. ✅ Логика сценария понятна и последовательна?
9. ✅ Сценарий имеет теги для фильтрации?
10. ✅ Указаны все необходимые предусловия?

## 12. Полезные ссылки

- Документация: https://pr-mex.github.io/vanessa-automation/dev/
- GitHub: https://github.com/Pr-Mex/vanessa-automation
- Телеграм канал: https://t.me/VanessaAutomation
- Telegram группа: https://t.me/testspro1c

---

**Версия документа:** 1.0  
**Дата создания:** 2025  
**На основе:** Vanessa Automation 1.2.042.x
