# Практическое руководство: Шаблоны сценариев Vanessa Automation

## Содержание
1. [Базовые шаблоны](#базовые-шаблоны)
2. [Работа со справочниками](#работа-со-справочниками)
3. [Работа с документами](#работа-с-документами)
4. [Проверка отчетов](#проверка-отчетов)
5. [Тестирование обработок](#тестирование-обработок)
6. [Комплексные сценарии](#комплексные-сценарии)

---

## Базовые шаблоны

### Шаблон 1: Минимальный сценарий

```gherkin
# encoding: utf-8
# language: ru

Функционал: [Название функционала]
    Как [роль пользователя]
    Я хочу [действие]
    Чтобы [цель/результат]

Сценарий: [Название сценария]
    Дано [предусловие]
    Когда [действие]
    Тогда [ожидаемый результат]
```

### Шаблон 2: Сценарий с контекстом

```gherkin
# encoding: utf-8
# language: ru

@Категория
Функционал: [Название функционала]
    Как [роль]
    Я хочу [действие]
    Чтобы [цель]

Контекст:
    Дано Я запускаю сценарий открытия TestClient или подключаю уже существующий
    И Я закрыл все окна клиентского приложения

@ТегСценария
Сценарий: [Название сценария]
    Дано [предусловие]
    Когда [действие]
    Тогда [проверка]
```

---

## Работа со справочниками

### Создание элемента справочника

```gherkin
# encoding: utf-8
# language: ru

@Справочники @Создание
Функционал: Создание элементов справочника "Номенклатура"
    Как менеджер склада
    Я хочу создавать новые товары
    Чтобы вести учет номенклатуры

Контекст:
    Дано Я запускаю сценарий открытия TestClient или подключаю уже существующий
    И Я закрыл все окна клиентского приложения

Сценарий: Создание нового товара через форму
    # Открываем список справочника
    Дано Я открываю навигационную ссылку "e1cib/list/Справочник.Номенклатура"
    
    # Создаем новый элемент
    Когда я нажимаю на кнопку с именем "FormCreate"
    Тогда открылось окно "Номенклатура (создание)"
    
    # Заполняем основные поля
    И в поле "Наименование" я ввожу текст "Товар тестовый"
    И в поле "Артикул" я ввожу текст "TEST-001"
    
    # Выбираем из справочника
    И из выпадающего списка "ВидНоменклатуры" я выбираю по строке "Товар"
    И из выпадающего списка "ЕдиницаИзмерения" я выбираю по строке "шт"
    
    # Записываем и проверяем
    И я нажимаю на кнопку с именем "FormWrite"
    Тогда элемент формы с именем "Наименование" стал равен "Товар тестовый"
    И я запоминаю значение поля "Код" в переменную "КодТовара"
    
    # Закрываем форму
    И я закрываю текущее окно
```

### Редактирование элемента справочника

```gherkin
# encoding: utf-8
# language: ru

@Справочники @Редактирование
Функционал: Редактирование справочника "Контрагенты"
    Как бухгалтер
    Я хочу изменять реквизиты контрагента
    Чтобы актуализировать информацию

Сценарий: Изменение ИНН контрагента
    # Открываем существующий элемент
    Дано Я открываю навигационную ссылку "e1cib/data/Справочник.Контрагенты?ref=a1b2c3d4e5f6"
    Тогда открылось окно "Контрагент*"
    
    # Изменяем поле
    Когда в поле "ИНН" я ввожу текст "9876543210"
    И в поле "КПП" я ввожу текст "987654321"
    
    # Сохраняем
    И я нажимаю на кнопку "Записать и закрыть"
    
    # Проверяем, что изменения сохранились
    И Я открываю навигационную ссылку "e1cib/data/Справочник.Контрагенты?ref=a1b2c3d4e5f6"
    Тогда элемент формы с именем "ИНН" стал равен "9876543210"
```

### Поиск в справочнике

```gherkin
# encoding: utf-8
# language: ru

@Справочники @Поиск
Функционал: Поиск элементов справочника
    Как пользователь
    Я хочу быстро находить нужные элементы
    Чтобы эффективно работать с системой

Сценарий: Поиск контрагента по наименованию
    Дано Я открываю навигационную ссылку "e1cib/list/Справочник.Контрагенты"
    
    # Используем строку поиска
    Когда в поле "СтрокаПоиска" я ввожу текст "ООО Рога"
    И я нажимаю клавишу "Enter"
    
    # Проверяем результаты
    Тогда таблица "Список" содержит "1" строк
    И в таблице "Список" в поле "Наименование" я вижу текст "ООО Рога и копыта"
```

---

## Работа с документами

### Создание документа с табличной частью

```gherkin
# encoding: utf-8
# language: ru

@Документы @Создание
Функционал: Создание документа "Заказ покупателя"
    Как менеджер по продажам
    Я хочу оформлять заказы от покупателей
    Чтобы зафиксировать заявки клиентов

Контекст:
    Дано Я запускаю сценарий открытия TestClient или подключаю уже существующий
    И Я закрыл все окна клиентского приложения

Сценарий: Создание заказа с несколькими товарами
    # Создаем новый документ
    Дано Я открываю навигационную ссылку "e1cib/list/Документ.ЗаказПокупателя"
    Когда я нажимаю на кнопку "Создать"
    Тогда открылось окно "Заказ покупателя (создание)"
    
    # Заполняем шапку документа
    И в поле "Дата" я ввожу текущую дату
    И из выпадающего списка "Организация" я выбираю по строке "ООО Моя фирма"
    И из выпадающего списка "Покупатель" я выбираю по строке "ООО Рога и копыта"
    И из выпадающего списка "Склад" я выбираю по строке "Основной склад"
    
    # Заполняем табличную часть
    И в таблице "Товары" я нажимаю на кнопку с именем "ТоварыДобавить"
    И в таблице "Товары" из выпадающего списка "Номенклатура" я выбираю по строке "Товар 1"
    И в таблице "Товары" в поле "Количество" я ввожу текст "10"
    И в таблице "Товары" в поле "Цена" я ввожу текст "100.00"
    И в таблице "Товары" я завершаю редактирование строки
    
    # Добавляем вторую позицию
    И в таблице "Товары" я нажимаю на кнопку с именем "ТоварыДобавить"
    И в таблице "Товары" из выпадающего списка "Номенклатура" я выбираю по строке "Товар 2"
    И в таблице "Товары" в поле "Количество" я ввожу текст "5"
    И в таблице "Товары" в поле "Цена" я ввожу текст "200.00"
    И в таблице "Товары" я завершаю редактирование строки
    
    # Проверяем итоги
    Тогда таблица "Товары" содержит "2" строк
    И элемент формы с именем "СуммаДокумента" стал равен "2 000,00"
    
    # Записываем документ
    И я нажимаю на кнопку "Записать"
    И я запоминаю значение поля "Номер" в переменную "НомерЗаказа"
```

### Проведение документа

```gherkin
# encoding: utf-8
# language: ru

@Документы @Проведение
Функционал: Проведение документа "Поступление товаров"
    Как кладовщик
    Я хочу провести приходную накладную
    Чтобы отразить поступление товаров в учете

Сценарий: Проведение документа поступления
    # Открываем непроведенный документ
    Дано Я открываю навигационную ссылку "e1cib/data/Документ.ПоступлениеТоваров?ref=a1b2c3d4e5f6"
    Тогда открылось окно "Поступление товаров*"
    
    # Проверяем статус
    Тогда элемент формы с именем "Проведен" стал равен "Нет"
    
    # Проводим документ
    Когда я нажимаю на кнопку "Провести и закрыть"
    
    # Открываем заново и проверяем
    И Я открываю навигационную ссылку "e1cib/data/Документ.ПоступлениеТоваров?ref=a1b2c3d4e5f6"
    Тогда элемент формы с именем "Проведен" стал равен "Да"
```

### Проверка движений документа (рекомендуемый подход)

```gherkin
# encoding: utf-8
# language: ru

@Документы @ПроверкаДвижений
Функционал: Проверка движений документа "Реализация товаров"
    Как разработчик
    Я хочу проверить корректность движений
    Чтобы убедиться в правильности учета

Контекст:
    Дано Существует эталонная база с подготовленными документами

Сценарий: Проверка остатков после реализации
    # Отменяем проведение для возврата к начальному состоянию
    И я отменяю проведение всех документов этого сценария по их навигационным ссылкам (расширение)
    
    # Проводим документ программно (без открытия формы)
    И я выполняю проведение документа по навигационной ссылке "e1cib/data/Документ.РеализацияТоваров?ref=a1b2c3d4e5f6g7h8i9j0" (расширение)
    
    # Проверяем движения через отчет
    И вариант отчета "ОстаткиТоваров" "Остатки на складах" равен макету "ЭталонПослеРеализации" (расширение)
    
    # Возвращаем базу в исходное состояние
    И я отменяю проведение всех документов этого сценария по их навигационным ссылкам (расширение)
```

### Создание документа на основании другого

```gherkin
# encoding: utf-8
# language: ru

@Документы @СозданиеНаОсновании
Функционал: Создание документов на основании
    Как менеджер
    Я хочу создавать документы на основании существующих
    Чтобы упростить ввод данных

Сценарий: Создание отгрузки на основании заказа
    # Открываем заказ
    Дано Я открываю навигационную ссылку "e1cib/data/Документ.ЗаказПокупателя?ref=a1b2c3d4e5f6"
    Тогда открылось окно "Заказ покупателя*"
    
    # Запоминаем ссылку на заказ
    И я запоминаю навигационную ссылку активного объекта в переменную "СсылкаНаЗаказ"
    
    # Создаем на основании
    Когда я нажимаю на кнопку "Создать на основании"
    И в меню "Создать на основании" я выбираю "Отгрузка товаров"
    Тогда открылось окно "Отгрузка товаров (создание)"
    
    # Проверяем, что документ основание заполнился
    Тогда элемент формы с именем "ДокументОснование" стал равен "$СсылкаНаЗаказ$"
    
    # Проверяем, что табличная часть заполнилась
    Тогда таблица "Товары" стала равной по шаблону:
        | Номенклатура | Количество |
        | *            | >0         |
    
    # Проводим
    И я нажимаю на кнопку "Провести и закрыть"
```

---

## Проверка отчетов

### Формирование и проверка отчета

```gherkin
# encoding: utf-8
# language: ru

@Отчеты @Формирование
Функционал: Формирование отчета "Остатки товаров"
    Как аналитик
    Я хочу получать актуальные данные об остатках
    Чтобы контролировать наличие товаров

Сценарий: Формирование отчета по складу
    # Открываем отчет
    Дано Я открываю навигационную ссылку "e1cib/app/Отчет.ОстаткиТоваров"
    Тогда открылось окно "Остатки товаров"
    
    # Устанавливаем период
    И в поле "Период" я ввожу текущую дату
    
    # Выбираем склад
    И из выпадающего списка "Склад" я выбираю по строке "Основной склад"
    
    # Формируем
    Когда я нажимаю на кнопку "Сформировать"
    
    # Проверяем, что отчет сформировался
    Тогда табличный документ "Результат" содержит строки:
        | Номенклатура | Количество |
        | *            | *          |
    
    # Проверяем конкретные значения
    И в табличном документе "Результат" я ищу строку где "Номенклатура" равно "Товар 1"
    Тогда в ячейке "Количество" значение больше "0"
```

### Сравнение отчета с эталоном

```gherkin
# encoding: utf-8
# language: ru

@Отчеты @Эталон
Функционал: Проверка отчетов по эталону
    Как тестировщик
    Я хочу сравнивать отчеты с эталонными значениями
    Чтобы обнаружить отклонения в учете

Сценарий: Сравнение остатков с эталоном
    # Подготовка данных
    И я отменяю проведение всех документов этого сценария по их навигационным ссылкам (расширение)
    И я выполняю проведение документа по навигационной ссылке "e1cib/data/Документ.ПоступлениеТоваров?ref=..." (расширение)
    
    # Проверка через отчет
    И вариант отчета "ОстаткиТоваров" "Остатки на складах" равен макету "ЭталонПослеПоступления" (расширение)
    
    # Очистка
    И я отменяю проведение всех документов этого сценария по их навигационным ссылкам (расширение)
```

---

## Тестирование обработок

### Запуск обработки с параметрами

```gherkin
# encoding: utf-8
# language: ru

@Обработки @Выполнение
Функционал: Запуск обработки "Загрузка данных"
    Как администратор
    Я хочу загружать данные из файла
    Чтобы быстро наполнить справочники

Сценарий: Загрузка номенклатуры из Excel
    # Открываем обработку
    Дано Я открываю внешнюю обработку "ЗагрузкаНоменклатуры.epf"
    Тогда открылось окно "Загрузка номенклатуры"
    
    # Выбираем файл
    И я нажимаю на кнопку "Выбрать файл"
    И я выбираю файл "C:\Data\nomenclature.xlsx"
    Тогда элемент формы с именем "ФайлДанных" стал равен "nomenclature.xlsx"
    
    # Запускаем обработку
    Когда я нажимаю на кнопку "Загрузить"
    
    # Ожидаем завершения
    И пауза "5"
    
    # Проверяем результат
    Тогда открылось окно "Результат загрузки"
    И элемент формы с именем "ЗагруженоЭлементов" стал равен "100"
```

---

## Комплексные сценарии

### Полный цикл продажи

```gherkin
# encoding: utf-8
# language: ru

@Комплексный @ЦиклПродажи
Функционал: Полный цикл продажи товаров
    Как тестировщик
    Я хочу проверить весь процесс продажи
    Чтобы убедиться в корректности всех этапов

Контекст:
    Дано Я запускаю сценарий открытия TestClient или подключаю уже существующий
    И Я закрыл все окна клиентского приложения

Сценарий: От заказа до оплаты
    # 1. Создаем заказ покупателя
    Дано Я открываю навигационную ссылку "e1cib/list/Документ.ЗаказПокупателя"
    Когда я нажимаю на кнопку "Создать"
    Тогда открылось окно "Заказ покупателя (создание)"
    И из выпадающего списка "Покупатель" я выбираю по строке "ООО Рога и копыта"
    И в таблице "Товары" я нажимаю на кнопку "Добавить"
    И в таблице "Товары" из выпадающего списка "Номенклатура" я выбираю по строке "Товар 1"
    И в таблице "Товары" в поле "Количество" я ввожу текст "10"
    И в таблице "Товары" я завершаю редактирование строки
    И я нажимаю на кнопку "Провести и закрыть"
    И я запоминаю навигационную ссылку активного объекта в переменную "СсылкаНаЗаказ"
    
    # 2. Создаем отгрузку на основании заказа
    И Я открываю навигационную ссылку "$СсылкаНаЗаказ$"
    Когда я нажимаю на кнопку "Создать на основании"
    И в меню я выбираю "Отгрузка товаров"
    Тогда открылось окно "Отгрузка товаров (создание)"
    И я нажимаю на кнопку "Провести и закрыть"
    И я запоминаю навигационную ссылку активного объекта в переменную "СсылкаНаОтгрузку"
    
    # 3. Создаем реализацию на основании отгрузки
    И Я открываю навигационную ссылку "$СсылкаНаОтгрузку$"
    Когда я нажимаю на кнопку "Создать на основании"
    И в меню я выбираю "Реализация товаров"
    Тогда открылось окно "Реализация товаров (создание)"
    И я нажимаю на кнопку "Провести и закрыть"
    И я запоминаю навигационную ссылку активного объекта в переменную "СсылкаНаРеализацию"
    
    # 4. Создаем оплату
    И Я открываю навигационную ссылку "$СсылкаНаРеализацию$"
    Когда я нажимаю на кнопку "Создать на основании"
    И в меню я выбираю "Поступление на расчетный счет"
    Тогда открылось окно "Поступление на расчетный счет (создание)"
    И я нажимаю на кнопку "Провести и закрыть"
    
    # 5. Проверяем взаиморасчеты
    Дано Я открываю навигационную ссылку "e1cib/app/Отчет.ВзаиморасчетыСКонтрагентами"
    И из выпадающего списка "Контрагент" я выбираю по строке "ООО Рога и копыта"
    Когда я нажимаю на кнопку "Сформировать"
    Тогда в табличном документе "Результат" итоговая задолженность равна "0"
```

### Работа с несколькими окнами

```gherkin
# encoding: utf-8
# language: ru

@Комплексный @МногоОкон
Функционал: Работа с несколькими окнами
    Как пользователь
    Я хочу работать с несколькими документами одновременно
    Чтобы сравнивать и копировать данные

Сценарий: Копирование данных между документами
    # Открываем первый документ
    Дано Я открываю навигационную ссылку "e1cib/data/Документ.ЗаказПокупателя?ref=aaaa"
    Тогда открылось окно "Заказ покупателя*"
    И я запоминаю заголовок формы в переменную "ОкноЗаказа"
    
    # Копируем данные
    И я запоминаю значение поля "Покупатель" в переменную "Покупатель"
    
    # Открываем второй документ
    И Я открываю навигационную ссылку "e1cib/data/Документ.ЗаказПокупателя?ref=bbbb"
    Тогда открылось окно "Заказ покупателя*"
    
    # Вставляем данные
    И из выпадающего списка "Покупатель" я выбираю по строке "$Покупатель$"
    И я нажимаю на кнопку "Записать"
    И я закрываю текущее окно
    
    # Возвращаемся к первому окну
    И Я активизирую окно "$ОкноЗаказа$"
    И я закрываю текущее окно
```

---

## Дополнительные паттерны

### Использование циклов (через подсценарии)

```gherkin
# encoding: utf-8
# language: ru

@Паттерн @Цикл
Функционал: Массовое создание элементов
    Как тестировщик
    Я хочу создать несколько элементов
    Чтобы подготовить тестовые данные

Сценарий: Создание 10 товаров
    # Используем счетчик
    И я запоминаю значение выражения "1" в переменную "Счетчик"
    
    # Первая итерация
    И я выполняю подсценарий "СозданиеТовара" с параметром "$Счетчик$"
    И я запоминаю значение выражения "$Счетчик$ + 1" в переменную "Счетчик"
    
    # Вторая итерация
    И я выполняю подсценарий "СозданиеТовара" с параметром "$Счетчик$"
    И я запоминаю значение выражения "$Счетчик$ + 1" в переменную "Счетчик"
    
    # ... и так далее до 10
```

### Обработка ошибок

```gherkin
# encoding: utf-8
# language: ru

@Паттерн @ОбработкаОшибок
Функционал: Обработка ошибок при вводе
    Как тестировщик
    Я хочу проверить валидацию данных
    Чтобы убедиться в корректности проверок

Сценарий: Попытка провести незаполненный документ
    Дано Я открываю навигационную ссылку "e1cib/list/Документ.ЗаказПокупателя"
    Когда я нажимаю на кнопку "Создать"
    Тогда открылось окно "Заказ покупателя (создание)"
    
    # Пытаемся провести без заполнения
    Когда я нажимаю на кнопку "Провести"
    
    # Ожидаем сообщение об ошибке
    Тогда появилось предупреждение "Не заполнено поле Покупатель"
    
    # Закрываем предупреждение
    И я нажимаю на кнопку "ОК"
    
    # Проверяем, что документ не проведен
    Тогда элемент формы с именем "Проведен" стал равен "Нет"
```

---

## Лучшие практики

### ✅ Правильно

1. **Используйте осмысленные имена переменных:**
```gherkin
И я запоминаю значение поля "Покупатель" в переменную "ТекущийПокупатель"
```

2. **Добавляйте проверки после каждого критичного действия:**
```gherkin
И я нажимаю на кнопку "Провести"
Тогда элемент формы с именем "Проведен" стал равен "Да"
```

3. **Группируйте шаги логически:**
```gherkin
# Заполнение шапки документа
...
# Заполнение табличной части
...
# Проведение документа
...
```

### ❌ Неправильно

1. **Не создавайте слишком длинные сценарии (более 50 шагов)**
2. **Не дублируйте одинаковые последовательности шагов** - используйте подсценарии
3. **Не смешивайте тестирование UI и тестирование движений** в одном сценарии
4. **Не используйте "магические" значения** - используйте переменные

---

## Полезные команды и настройки

### Запуск сценариев

```bash
# Запуск всех сценариев
1cv8 /Execute vanessa-automation.epf /C"StartFeaturePlayer;VAParams=VAParams.json"

# Запуск с конкретным тегом
1cv8 /Execute vanessa-automation.epf /C"StartFeaturePlayer;VAParams=VAParams.json;Tags=@Smoke"

# Запуск с исключением тегов
1cv8 /Execute vanessa-automation.epf /C"StartFeaturePlayer;VAParams=VAParams.json;ExcludeTags=@Draft"
```

### VAParams.json - минимальная конфигурация

```json
{
  "КаталогФич": "./features",
  "ВыполнитьСценарии": true,
  "ЗавершитьРаботуСистемы": true,
  "ВыгружатьСтатусВыполненияСценариевВФайл": true,
  "ПутьКФайлуДляВыгрузкиСтатусаВыполненияСценариев": "./status.txt",
  "СписокТеговИсключение": ["@Draft", "@Ignore"]
}
```

---

**Примечание:** Все шаги в примерах взяты из официальной библиотеки Vanessa Automation. При создании своих сценариев используйте только шаги из библиотеки или создавайте композитные шаги через подсценарии.
